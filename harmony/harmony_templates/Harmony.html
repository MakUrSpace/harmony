<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="/bootstrap.min.css">
    <script src="/bootstrap.min.js"></script>
    <script src="/htmx.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/HarmonyTemplate.css">

    <title>Harmony</title>
</head>

<body>
    <div class="container">
        <h1 align="center">Harmony</h1>
        <hr>
        <div class="row justify-content-center mb-3">
            <h4>Session ID: {viewId}
                <button class="btn btn-sm btn-outline-secondary"
                    onclick="document.getElementById('updateSessionForm').hidden = !document.getElementById('updateSessionForm').hidden">Edit</button>
            </h4>
        </div>
        <div id="updateSessionForm" class="row justify-content-center mb-3" hidden>
            <form action="{harmonyURL}update_session_id" method="POST" class="form-inline">
                <input type="hidden" name="viewId" value="{viewId}">
                <input type="text" name="newViewId" class="form-control mr-2" placeholder="New Session ID" required>
                <button type="submit" class="btn btn-primary">Update</button>
            </form>
        </div>
        <div class="row" style="min-width: 500px">
            <div class="container justify-content-center" align="center">
                <h3 id="GameWorldHeader">Game World View -- {defaultCamera}</h3>
                <form id="selectPixelForm" hx-post="{harmonyURL}select_pixel" hx-target="#interactor">
                    <input type="hidden" name="selectedCamera" id="selectedCamera" value="{defaultCamera}">
                    <input type="hidden" name="selectedPixel" id="selectedPixel" value="">
                    <input type="hidden" name="appendPixel" id="appendPixel" value="false">
                    <input type="hidden" name="viewId" id="viewId" value="{viewId}">
                </form>
                <div id="GameWorldViewer" style="position: relative;">
                    <img id="GameWorld" class="img-responsive border border-3 border-info bg-primary"
                        src="{harmonyURL}camWithChanges/{defaultCamera}/{viewId}"
                        style="border-radius: 40px; max-width: 90%;">
                    <canvas id="GameWorldOverlay"
                        style="position:absolute; left:0; top:0; pointer-events:auto;"></canvas>
                </div>
                <script src="/HarmonyCanvas.js"></script>
                <script>
                    // Initialize Canvas
                    window.addEventListener('load', function () {
                        initHarmonyCanvas();
                        // Poll every 1 second
                        setInterval(function () { syncCanvasData(document.getElementById("viewId").value); }, 1000);
                    });
                </script>
            </div>
            <div class="container justify-content-center" align="center">
                {cameraButtons}
            </div>
            <div class="row justify-content-center" align="center" style="min-width: 500px">
                <div id="interactor" class="row"></div>
                <div id="objectTable" class="row">
                    <div id="objectFilterRetriever" hx-get="{harmonyURL}objects" hx-trigger="every 1s"
                        hx-include="#viewId" hx-target="#objectFilterRetriever"></div>
                </div>
                <hr>
                <div class="row">
                    <div class="col" align="left">
                        <form hx-post="{harmonyURL}save" hx-swap="none">
                            <input class="btn btn-success" type="submit" value="Save Game">
                            <input class="text" value="Harmony" id="game_name" name="game_name">
                        </form>
                    </div>
                </div>
                <div class="row">
                    <div class="col" align="left">
                        <input class="btn btn-warning" type="submit" value="Load Game" onclick="loadGame()">
                        <form id="load_game" hx-post="{harmonyURL}load" hx-target="#load_status" hx-swap="innerHTML">
                            <input type="hidden" value="Harmony" id="load_game_name" name="game_name">
                        </form>
                        <div id="load_status" class="text-sm text-muted mt-1"></div>
                        <script>
                            function loadGame() {
                                const gameNameVal = document.getElementById(`game_name`).value
                                const loadGameField = document.getElementById(`load_game_name`)
                                loadGameField.value = gameNameVal
                                const loadGameForm = document.getElementById(`load_game`)
                                loadGameForm.requestSubmit()
                            }
                        </script>
                    </div>
                    <div class="col" align="center">
                        <button class="btn btn-info" onclick=" window.open('{harmonyURL}control','_blank')">Session
                            Control Panels</button>
                        <button class="btn btn-secondary ml-2"
                            onclick=" window.open('/configurator/','_blank')">Configurator</button>
                    </div>
                    <div class="col" align="right">
                        <input class="btn btn-danger" type="button" value="Reset Game" hx-get="{harmonyURL}reset">
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>